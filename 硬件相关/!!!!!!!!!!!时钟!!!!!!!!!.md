为什么要打开时钟：芯片是低功耗的，芯片复位之后外设都是关闭状态，要用外设之前都需要打开外设的时钟

时钟相当于外设的开关，不打开时钟，则晶振产生的振荡信号就无法输入到MCU内部的外设中，则没有时钟信号，触发器无法触发，则触发器无法锁存数据，而寄存器是由N个触发器组成，所以寄存器就无法工作，而控制硬件，必须通过寄存器实现。



STM32的MCU内部有很多外设，每个外设的作用和性能都各不相同，ST公司为了降低芯片功耗，把不同性能的外设挂载在不同性能的总线上，需要掌握3条总线：AHB高级高性能总线（总线频率是168MHZ）、APB1高级外设总线（总线频率是42MHZ）、APB2高级外设总线（总线频率是84MHZ）。



时钟信号：周期性的脉冲，要不断的提供给触发器，触发器才能触发，寄存器才能锁存（一个bit）



寄存器和时钟的关系：寄存器由触发器组成可以锁存一个bit，前提是提供触发方式（电平触发、边沿触发、脉冲触发），脉冲光波由高低电平组成，高低电平切换则会产生上升沿下降沿，所以前提要有脉冲触发器才能工作，寄存器才能工作。脉冲信号由时钟提供，时钟由晶振周期性振荡提供。

触发器有双稳态（既能存0，也能存1）

------

定时器频率来自总线，总线来自系统时钟，系统时钟来自 PLL，PLL来源于 HSE/HSI(时钟源)

时钟源：①HSE高速外部时钟 	②HSI高速内部时钟	③LSE低速外部时钟	④LSI低速内部时钟	⑤PLL倍频锁相环

```diff
┌────────────┐
│  HSE / HSI │   ← 外部 / 内部时钟源
└────┬───────┘
     ↓
┌────────────┐
│    PLL     │   ← 倍频器，输出高速时钟
└────┬───────┘
     ↓
┌────────────┐
│  SYSCLK    │   ← 系统主频（主系统时钟）
└────┬───────┘
     ↓
┌────────────┐
│ AHB 总线   │   ← 高速总线 HCLK（用于 CPU 和内核）
└────┬───────┘
     ↓
┌────────────────────────────┐
│ APB1 总线（低速）   ← TIM2、TIM3、TIM4、TIM5 等         │
│ APB2 总线（高速）   ← TIM1、TIM8、USART1、ADC等         │
└────┬──────────────────────┘
     ↓
┌────────────────────────────┐
│ TIMx 定时器时钟频率                                   │
│ ↳ TIMxCLK = APBxCLK × 2（当 APBx 被分频时）           │
│ ↳ TIMxCLK = APBxCLK     （当 APBx 无分频时）          │
└────┬──────────────────────┘
     ↓
┌────────────┐
│ TIMx 寄存器 │ ← 控制定时器运行参数（PSC、ARR、CNT、CCR）
└────┬───────┘
     ↓
┌────────────────────────────┐
│ TIM 通道（CH1~CH4）        │
│ ↳ 输出比较（PWM）          │
│ ↳ 输入捕获（测频/脉宽）     │
└────┬──────────────────────┘
     ↓
┌────────────┐
│   NVIC     │ ← 中断控制器，分发中断到 ISR
└────────────┘
```



SysTick 用于系统，基本定时器用于周期中断，高级定时器负责所有复杂控制和捕获功能。

| 特性         | **SysTick**                  | **基本定时器（TIM6/7）**       | **通用/高级定时器（TIM2~5, TIM1/8）**   |
| ------------ | ---------------------------- | ------------------------------ | --------------------------------------- |
| 属于谁       | Cortex-M4 内核内部           | STM32 外设                     | STM32 外设                              |
| 位于哪个模块 | ARM 内核                     | APB1 总线                      | TIM2~5 → APB1TIM1/8 → APB2              |
| 时钟源       | HCLK（内核时钟）             | APB1 时钟                      | APB1/APB2，总线 ×2（分频器 >1）         |
| 中断功能     | 支持                         | 支持（用于触发 DAC 等）        | 支持，丰富中断                          |
| 主要用途     | 系统心跳节拍，延时、RTOS调度 | 基础定时，DAC 触发、周期中断等 | 高级应用，PWM、输入捕获、编码器、比较等 |

