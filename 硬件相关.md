PN 结是指将P型半导体和N型半导体连接在一起后，在它们的交界面处形成的一个结区，是半导体器件（如二极管、三极管、MOS管等）的基本结构单元。二极管：只允许电流从 P → N 单向流动，LED 发光二极管：在正向导通时发光。

 ***正向偏置原理图（导通）：***				

  电源+      P区 → N区      电源-
     |           	|                  |
   ↑↑↑            耗尽区          ↓↓↓
（空穴）   电场被抵消  （电子）
→载流子自由运动，形成电流→

***反向偏置原理图（截止）：***

  电源-    P区 ← N区    电源+
     |         	|                |
   ↑↑↑          耗尽区         ↓↓↓
（空穴）←←耗尽区更宽←←（电子）
→电场加强，载流子被阻止，不导电

***零偏置：***

不导通，也不截止。

------

为什么要打开时钟：芯片是低功耗的，芯片复位之后外设都是关闭状态，要用外设之前都需要打开外设的时钟

时钟相当于外设的开关，不打开时钟，则晶振产生的振荡信号就无法输入到MCU内部的外设中，则没有时钟信号，触发器无法触发，则触发器无法锁存数据，而寄存器是由N个触发器组成，所以寄存器就无法工作，而控制硬件，必须通过寄存器实现。



STM32的MCU内部有很多外设，每个外设的作用和性能都各不相同，ST公司为了降低芯片功耗，把不同性能的外设挂载在不同性能的总线上，需要掌握3条总线：AHB高级高性能总线（总线频率是168MHZ）、APB1高级外设总线（总线频率是42MHZ）、APB2高级外设总线（总线频率是84MHZ）。



时钟信号：周期性的脉冲，要不断的提供给触发器，触发器才能触发，寄存器才能锁存（一个bit）



寄存器和时钟的关系：寄存器由触发器组成可以锁存一个bit，前提是提供触发方式（电平触发、边沿触发、脉冲触发），脉冲光波由高低电平组成，高低电平切换则会产生上升沿下降沿，所以前提要有脉冲触发器才能工作，寄存器才能工作。脉冲信号由时钟提供，时钟由晶振周期性振荡提供。

触发器有双稳态（既能存0，也能存1）





**晶振 (压电效应) 要尽可能挨着芯片  ： 容易起振，减少输出失真**

------

**有源蜂鸣器**像一个自带“音乐播放器”的喇叭，只要给电，它就播放内置的声音（固定频率）；

**无源蜂鸣器**像一个“扬声器”，需要外部信号“指挥”它如何发声（频率+占空比），可以发出不同音调（比如音乐）。

------

NVIC利用4bit的优先级来管理所有的中断通道，STM32中断的优先级分为两种：抢占式优先级（主优先级） + 响应式优先级（子优先级），每种都有16个优先级（0~15），**数字越小，优先级越高。**

------

EXTI指的是外部中断/事件控制器，一共有23个，每个都有一个内部的**边沿检测器**，可以检测上升沿或者下降沿，每根线都可以产生事件或者中断。

------

PWM（Pulse Width Modulation）：脉冲宽度调制

本质是：通过**控制脉冲高电平时间的占比（占空比）**来控制模拟效果（如亮度、电机速度）。

### 输入捕获测 PWM：

1. 配置 TIMx 的 CH1 为输入捕获模式，检测上升沿 → 得到周期起始
2. 配置 CH2 为输入捕获，检测下降沿 → 得到高电平宽度
3. 算出周期 = 上升沿时间差
    占空比 = 高电平 / 周期

### 输出 PWM：

1. 设置 TIMx 为 PWM 模式
2. `ARR = 总周期`
3. `CCR = 高电平时间`
4. 开启输出通道，产生稳定 PWM 波形

------

定时器频率来自总线，总线来自系统时钟，系统时钟来自 PLL，PLL来源于 HSE/HSI(时钟源)

时钟源：①HSE高速外部时钟 	②HSI高速内部时钟	③LSE低速外部时钟	④LSI低速内部时钟	⑤PLL倍频锁相环

[HSE / HSI]
     ↓
   [PLL]				← 倍频模块
     ↓
  SYSCLK		   	← 系统主频
     ↓
 AHB 总线 HCLK		← CPU + 内核总线
     ↓
APB1 / APB2 总线      	← 外设总线
     ↓
  TIMx 定时器时钟频率	← 实际供定时器用的时钟



SysTick 用于系统，基本定时器用于周期中断，高级定时器负责所有复杂控制和捕获功能。

| 特性                | **SysTick**                  | **基本定时器（TIM6/7）**       | **通用/高级定时器（TIM2~5, TIM1/8）**   |
| ------------------- | ---------------------------- | ------------------------------ | --------------------------------------- |
| 属于谁              | Cortex-M4 内核内部           | STM32 外设                     | STM32 外设                              |
| 位于哪个模块        | ARM 内核                     | APB1 总线                      | TIM2~5 → APB1TIM1/8 → APB2              |
| 时钟源              | HCLK（内核时钟）             | APB1 时钟                      | APB1/APB2，总线 ×2（分频器 >1）         |
| 中断功能            | 支持                         | 支持（用于触发 DAC 等）        | 支持，丰富中断                          |
| PWM / 捕获 / 编码器 | ❌ 不支持                     | ❌ 不支持                       | ✅ 支持多种模式                          |
| 主要用途            | 系统心跳节拍，延时、RTOS调度 | 基础定时，DAC 触发、周期中断等 | 高级应用，PWM、输入捕获、编码器、比较等 |



------

**CH340** 是 **USB 转串口芯片**，广泛用于将 **USB 接口转换为 UART 串口**，把电脑的 **USB 接口** 转换成标准的 **串口（TX/RX）**，让电脑能通过串口与 MCU、单片机、模块通信。。

------

***1bit启动位，8bit数据位，1bit停止位，无校验位***

一般串口通信常用的波特率为***9600bps***、115200bps

------

模数转换器：取样，量化（最小量化单位），编码

------

```c
//循环8次，接收一个字节  MSB
for(int i = 0; i < 8;i++)
{
	data << = 1;
	data | = DHT11_ReadBit();
}
```

------

RFID：防碰撞，	按键：消抖

低频RFID  主频13.56MHz

------

如果某个IO口没有连接到定时器的通道上，那就无法使用定时器的通道来调节PWM脉冲信号，那此时可以选择使用**延时**来模拟脉冲信号，通过控制高电平和低电平的延时时间的长短来实现PWM调节。

```c
int main()
{
	//1.硬件的初始化
	LED_Config();
	
	//可以看到一个脉冲信号的周期是20ms，其中高电平持续19ms，所以占空比高，由于LED灯是低电平亮，所以占空比越高LED越暗
	while(1)
	{
		GPIO_ResetBits(GPIOF,GPIO_Pin_9);//LED亮
        delay_ms(1);
        GPIO_SetBits(GPIOF,GPIO_Pin_9);//LED不亮
        delay_ms(19);
	}
}
```

------

**模拟SPI脉冲信号:**

模式0：

```c
uint8_t SPI3_Send(u8 val)  
{ 
	int i = 0; 
	uint8_t data = 0;
	
	 //1.SCK引脚输出低电平
	 MFRC522_SCK(0);
	 delay_us(5);
		
	 //2.循环发送8次，每次发送一个bit  遵循MSB 高位先出
	 for(i=0;i<8;i++)
	 {
		 //3.判断待发送的字节的最高位  ???? ???? & 1000 0000
		 if( val & 0x80 )
		 {
				MFRC522_MOSI(1);
		 }
		 else
				MFRC522_MOSI(0);
		 
		 val <<= 1;
		 delay_us(5);
		 
		 //4.SCK引脚输出高电平，此时第一个边沿出现
		 MFRC522_SCK(1);
		 delay_us(5);
		 
		 //6.此时从机会响应一个bit，主机需要接收！
		 data <<= 1;
		 data |= MFRC522_MISO;
		 delay_us(5);	
		 
		 //7.SCK引脚输出低电平，此时第二个边沿出现
		 MFRC522_SCK(0);
		 delay_us(5);
	 }
		
	 return data;
}
```

------

**波特率**也称为码元传输速率，指的是单位时间内数字通信系统传输的码元个数（脉冲个数或者信号变化的次数），波特率的单位是波特（baud），码元可以采用二进制，也可以采用其他进制表示。

**比特率**也称为信息传输速率，指的是单位时间内数字通信系统传输的二进制码元的个数，比特率的单位是bit/s。

------

定时器的通道：

定时器本身就是一个计数器，但要实现更复杂的功能（比如 PWM、捕捉输入脉冲、定时触发事件等），就要靠 **“通道”** 来实现。

| 定时器功能   | 是否依赖通道 | 描述                                        |
| ------------ | ------------ | ------------------------------------------- |
| 基本计时     | 否           | 只用定时器本体，不用通道（比如 TIM6、TIM7） |
| PWM 输出     | ✅            | 每个 PWM 引脚由一个通道控制                 |
| 中断输出比较 | ✅            | 某个通道定点触发事件或中断                  |
| 捕获外部事件 | ✅            | 通道捕捉外部信号                            |
| 编码器接口   | ✅            | 需 2 个通道协同使用                         |

------

##  SYSCFG 的主要作用（以 STM32F1/F4/F7/L 系列为代表）

| 功能                   | 说明                                                       |
| ---------------------- | ---------------------------------------------------------- |
| 外部中断线映射（EXTI） | 把 GPIO 引脚映射到 EXTI 中断线（EXTI0～EXTI15）            |
| 内存映射控制           | 控制芯片复位后从哪个地址启动（Flash、SRAM、System memory） |
| I/O 复用控制           | 某些特殊外设或功能需要通过 SYSCFG 选择引脚                 |
| 快速模式 I2C 引脚      | 启用/关闭 I2C Fast Mode Plus（Fm+）支持                    |
| 模拟切换控制           | 比如 ADC 输入与 USB 引脚复用的管理                         |
| 电压监控、PVD 相关配置 | 电源检测和掉电检测功能（部分型号支持）                     |
| SRAM parity check      | 某些型号支持校验 bit 校验机制                              |
| Boost 模式（部分型号） | 支持低电压运行时开启内核升压功能                           |
